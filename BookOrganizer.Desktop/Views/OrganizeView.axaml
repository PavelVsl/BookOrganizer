<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:BookOrganizer.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="BookOrganizer.Desktop.Views.OrganizeView"
             x:DataType="vm:OrganizeViewModel">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header/Options -->
        <Border Grid.Row="0" Padding="12,8" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1">
            <StackPanel Spacing="8">
                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0" Text="Source:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <TextBox Grid.Column="1" Text="{Binding SourcePath}" Watermark="Source path..." />
                </Grid>
                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0" Text="Destination:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <TextBox Grid.Column="1" Text="{Binding DestinationPath}" Watermark="Destination path..." />
                </Grid>
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="Operation:" VerticalAlignment="Center" />
                    <ComboBox SelectedItem="{Binding OperationType}" Width="150">
                        <ComboBoxItem Content="Copy" />
                        <ComboBoxItem Content="Move" />
                        <ComboBoxItem Content="HardLink" />
                        <ComboBoxItem Content="SymbolicLink" />
                    </ComboBox>
                    <CheckBox Content="Validate integrity" IsChecked="{Binding ValidateIntegrity}" />
                    <CheckBox Content="Detect duplicates" IsChecked="{Binding DetectDuplicates}" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="Organize" Command="{Binding OrganizeCommand}"
                            IsEnabled="{Binding !IsOrganizing}" Classes="accent" />
                    <Button Content="Cancel" Command="{Binding OrganizeCancelCommand}"
                            IsEnabled="{Binding IsOrganizing}" />
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Progress area -->
        <StackPanel Grid.Row="1" Margin="16" Spacing="12" VerticalAlignment="Center" HorizontalAlignment="Center"
                    MaxWidth="600">
            <ProgressBar Value="{Binding ProgressPercent}" Maximum="100" Height="20"
                         IsVisible="{Binding IsOrganizing}" />

            <StackPanel Orientation="Horizontal" Spacing="16" HorizontalAlignment="Center"
                        IsVisible="{Binding IsOrganizing}">
                <TextBlock Text="{Binding CompletedAudiobooks, StringFormat='Audiobooks: {0}'}" />
                <TextBlock Text="{Binding TotalAudiobooks, StringFormat='of {0}'}" />
                <TextBlock Text="{Binding ProgressPercent, StringFormat='{}{0:0}%'}" FontWeight="SemiBold" />
            </StackPanel>

            <TextBlock Text="{Binding CurrentBook}" HorizontalAlignment="Center"
                       IsVisible="{Binding IsOrganizing}"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />

            <TextBlock Text="{Binding CurrentFile}" HorizontalAlignment="Center"
                       FontSize="11" TextTrimming="CharacterEllipsis"
                       IsVisible="{Binding IsOrganizing}"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />

            <!-- Result summary -->
            <Border Padding="16" CornerRadius="4"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                    IsVisible="{Binding ResultSummary, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Text="{Binding ResultSummary}" TextWrapping="Wrap" FontSize="14" />
            </Border>
        </StackPanel>

        <!-- Status bar -->
        <Border Grid.Row="2" Padding="12,4" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,1,0,0">
            <TextBlock Text="{Binding StatusText}" FontSize="12"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
        </Border>
    </Grid>

</UserControl>
