<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:BookOrganizer.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="BookOrganizer.Desktop.Views.BatchRenameView"
             x:DataType="vm:BatchRenameViewModel">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Padding="12,8" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1">
            <StackPanel Spacing="8">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <TextBlock Grid.Column="0" Text="Library:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <TextBox Grid.Column="1" Text="{Binding LibraryPath}" Watermark="Path to audiobook library..."
                             Margin="0,0,8,0" />
                    <Button Grid.Column="2" Content="Scan" Command="{Binding ScanEntriesCommand}"
                            IsEnabled="{Binding !IsLoading}" />
                </Grid>
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <RadioButton Content="Authors" IsChecked="{Binding IsAuthorMode}" GroupName="Mode" />
                    <RadioButton Content="Series" IsChecked="{Binding !IsAuthorMode}" GroupName="Mode" />
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Main content -->
        <Grid Grid.Row="1" ColumnDefinitions="350,Auto,*" Margin="8">
            <!-- Left: List of names -->
            <Grid Grid.Column="0" RowDefinitions="Auto,*">
                <TextBox Grid.Row="0" Text="{Binding FilterText}" Watermark="Filter..." Margin="0,0,0,4" />
                <ListBox Grid.Row="1" ItemsSource="{Binding FilteredEntries}"
                         SelectedItem="{Binding SelectedEntry}">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="vm:NameEntry">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="{Binding Name}" />
                                <TextBlock Grid.Column="1" Text="{Binding BookCount, StringFormat='({0})'}"
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                           Margin="8,0,0,0" />
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>

            <GridSplitter Grid.Column="1" Width="4" ResizeDirection="Columns"
                          Background="{DynamicResource SystemControlForegroundBaseLowBrush}" />

            <!-- Right: Rename panel -->
            <StackPanel Grid.Column="2" Spacing="12" Margin="16" MaxWidth="400"
                        IsVisible="{Binding SelectedEntry, Converter={x:Static ObjectConverters.IsNotNull}}">
                <TextBlock Text="Rename" FontSize="18" FontWeight="Bold" />

                <TextBlock Text="Current name:" FontSize="11"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                <TextBlock Text="{Binding SelectedEntry.Name}" FontWeight="SemiBold" FontSize="14" />

                <TextBlock Text="{Binding SelectedEntry.BookCount, StringFormat='Affects {0} book(s)'}"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />

                <TextBlock Text="New name:" FontSize="11"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="0,8,0,0" />
                <TextBox Text="{Binding NewName}" Watermark="Enter new name..." />

                <Button Content="Apply Rename" Command="{Binding ApplyRenameCommand}"
                        IsEnabled="{Binding !IsLoading}" Classes="accent" Margin="0,8,0,0" />
            </StackPanel>
        </Grid>

        <!-- Status bar -->
        <Border Grid.Row="2" Padding="12,4" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,1,0,0">
            <TextBlock Text="{Binding StatusText}" FontSize="12"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
        </Border>
    </Grid>

</UserControl>
