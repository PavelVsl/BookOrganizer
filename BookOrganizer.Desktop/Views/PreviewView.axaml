<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:BookOrganizer.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="BookOrganizer.Desktop.Views.PreviewView"
             x:DataType="vm:PreviewViewModel">

    <Grid RowDefinitions="Auto,Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Padding="12,8" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1">
            <StackPanel Spacing="8">
                <Grid ColumnDefinitions="Auto,*" >
                    <TextBlock Grid.Column="0" Text="Source:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <TextBox Grid.Column="1" Text="{Binding SourcePath}" Watermark="Source path..." />
                </Grid>
                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0" Text="Destination:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <TextBox Grid.Column="1" Text="{Binding DestinationPath}" Watermark="Destination path..." />
                </Grid>
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="Operation:" VerticalAlignment="Center" />
                    <ComboBox SelectedItem="{Binding OperationType}" Width="150">
                        <ComboBoxItem Content="Copy" />
                        <ComboBoxItem Content="Move" />
                        <ComboBoxItem Content="HardLink" />
                        <ComboBoxItem Content="SymbolicLink" />
                    </ComboBox>
                    <CheckBox Content="Detect duplicates" IsChecked="{Binding DetectDuplicates}" />
                    <Button Content="Generate Preview" Command="{Binding GenerateCommand}"
                            IsEnabled="{Binding !IsGenerating}" />
                    <Button Content="Cancel" Command="{Binding GenerateCancelCommand}"
                            IsEnabled="{Binding IsGenerating}" />
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Statistics -->
        <Border Grid.Row="1" Padding="12,8" IsVisible="{Binding TotalAudiobooks}">
            <StackPanel Orientation="Horizontal" Spacing="24">
                <TextBlock Text="{Binding TotalAudiobooks, StringFormat='Audiobooks: {0}'}" FontWeight="SemiBold" />
                <TextBlock Text="{Binding TotalFiles, StringFormat='Files: {0}'}" />
                <TextBlock Text="{Binding TotalSize, StringFormat='Size: {0}'}" />
                <TextBlock Text="{Binding IssueCount, StringFormat='Issues: {0}'}" />
            </StackPanel>
        </Border>

        <!-- Operations DataGrid -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Operations}" IsReadOnly="True"
                  Margin="8" GridLinesVisibility="Horizontal" AutoGenerateColumns="False">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Author" Binding="{Binding Author}" Width="150" />
                <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="200" />
                <DataGridTextColumn Header="Series" Binding="{Binding Series}" Width="120" />
                <DataGridTextColumn Header="Files" Binding="{Binding FileCount}" Width="60" />
                <DataGridTextColumn Header="Size (MB)" Binding="{Binding SizeMb, StringFormat='{}{0:0.#}'}" Width="80" />
                <DataGridTextColumn Header="Issues" Binding="{Binding IssueCount}" Width="60" />
                <DataGridTextColumn Header="Destination" Binding="{Binding DestinationPath}" Width="*" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- Status bar -->
        <Border Grid.Row="3" Padding="12,4" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,1,0,0">
            <TextBlock Text="{Binding StatusText}" FontSize="12"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
        </Border>
    </Grid>

</UserControl>
